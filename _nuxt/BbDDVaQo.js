import{_ as se}from"./CVo8TT1w.js";import{b as R,c as q,d as z,e as G,u as re,a as M,f as ue,V as D}from"./DU85qYpb.js";import{z as B,A as H,B as ne,C as ie,D as ce,E as de,F as fe,r as v,o as c,s as y,w as o,b as i,G as me,d as _,u as e,x as w,_ as pe,n as ge,c as L,a as N,v as f,H as ve,t as $,y as ye}from"./CJVNMOIT.js";import{m as _e,b as h,a as be,c as j,V as Ve}from"./DpEWxPBG.js";import"./Bxq0aJ9l.js";const K=B.reduce((a,t)=>(a[t]={type:[Boolean,String,Number],default:!1},a),{}),W=B.reduce((a,t)=>{const s="offset"+H(t);return a[s]={type:[String,Number],default:null},a},{}),Y=B.reduce((a,t)=>{const s="order"+H(t);return a[s]={type:[String,Number],default:null},a},{}),F={col:Object.keys(K),offset:Object.keys(W),order:Object.keys(Y)};function Ce(a,t,s){let u=a;if(!(s==null||s===!1)){if(t){const n=t.replace(a,"");u+=`-${n}`}return a==="col"&&(u="v-"+u),a==="col"&&(s===""||s===!0)||(u+=`-${s}`),u.toLowerCase()}}const ke=["auto","start","end","center","baseline","stretch"],he=ne({cols:{type:[Boolean,String,Number],default:!1},...K,offset:{type:[String,Number],default:null},...W,order:{type:[String,Number],default:null},...Y,alignSelf:{type:String,default:null,validator:a=>ke.includes(a)},...ie(),..._e()},"VCol"),$e=ce()({name:"VCol",props:he(),setup(a,t){let{slots:s}=t;const u=de(()=>{const n=[];let b;for(b in F)F[b].forEach(d=>{const k=a[d],m=Ce(b,d,k);m&&n.push(m)});const C=n.some(d=>d.startsWith("v-col-"));return n.push({"v-col":!C||!a.cols,[`v-col-${a.cols}`]:a.cols,[`offset-${a.offset}`]:a.offset,[`order-${a.order}`]:a.order,[`align-self-${a.alignSelf}`]:a.alignSelf}),n});return()=>{var n;return fe(a.tag,{class:[u.value,a.class],style:a.style},(n=s.default)==null?void 0:n.call(s))}}}),we={__name:"SuccessModal",setup(a){const t=v(!0);return(s,u)=>(c(),y(G,{modelValue:e(t),"onUpdate:modelValue":u[1]||(u[1]=n=>w(t)?t.value=n:null),"max-width":"500"},{default:o(()=>[i(R,null,{default:o(()=>[i(q,null,{default:o(()=>[me(s.$slots,"text",{},()=>[_("Completed")])]),_:3}),i(z,null,{default:o(()=>[i(h,{color:"primary",onClick:u[0]||(u[0]=n=>t.value=!1)},{default:o(()=>[_("Close")]),_:1})]),_:1})]),_:3})]),_:3},8,["modelValue"]))}},Ue={key:0,class:"text-right pr-4"},Se={key:0,class:"errorMessage text-left mr-auto pl-4"},xe={__name:"index",setup(a){const t=re("userId"),s=v(null),u=v(!1),n=v(null),b=v(""),C=v(""),d=v(""),k=v(""),m=v(""),U=v(""),p=v(null),S=v(!1),x=v(!1),V=ye();console.log(import.meta);function J(){s.value==="sign"&&X(),s.value==="login"&&Z(),s.value==="changeUserData"&&ae()}const Q={sign:"Create account",login:"Login",changeUserData:"Change account data"};function P(){m.value="",s.value=null,u.value=!1}function E(l){s.value=l}async function X(){try{await $fetch(`${V.public.apiUrl}/users/register`,{method:"POST",body:{name:b.value,email:C.value,password:d.value},credentials:"include"}),n.value="sign",P()}catch(l){console.log("Error adding user:",l.response._data.message),m.value=l.response._data.message}}async function Z(){try{const l=await $fetch(`${V.public.apiUrl}/users/login`,{method:"POST",body:{email:C.value,password:d.value},credentials:"include"});l.photo&&(U.value=`${V.public.apiUrl}/${l.photo}`),P(),p.value=l,t.value=l._id}catch(l){console.error("Error logging user:",l),m.value=l.response._data.message}}async function ee(){try{await $fetch(`${V.public.apiUrl}/users/logout`,{method:"POST",credentials:"include"}),n.value="logout",m.value="",p.value={},t.value=""}catch(l){console.error("Error logging user:",l),t.value="",m.value=l.response._data.message}}async function I(){try{if(!t.value){p.value={};return}const l=await $fetch(`${V.public.apiUrl}/users/current`,{method:"GET",credentials:"include"});p.value=l,l.photo&&(U.value=`${V.public.apiUrl}/${l.photo}`)}catch(l){console.error("Error fetching user data:",l),p.value=[],t.value=null}}async function ae(){if(d.value!==k.value){m.value="Passwords do not match";return}const l={};if(b.value&&(l.name=b.value),d.value&&(l.password=d.value),Object.keys(l).length===0){m.value="No data to update";return}t.value=p.value._id;try{const r=await $fetch(`${V.public.apiUrl}/users/${p.value._id}`,{method:"PATCH",body:l,credentials:"include"});P(),p.value=r,b.value="",d.value="",k.value=""}catch(r){console.error("Error updating user data:",r),m.value=r.response._data.message}}function le(l){U.value=`${V.public.apiUrl}/${l}`,I()}function te(){S.value=!S.value}return ge(()=>{I()}),(l,r)=>{const oe=se,T=we;return c(),L(ve,null,[N("div",null,[i(M,{class:"d-block"},{default:o(()=>{var g;return[i($e,{class:"text-right ml-auto"},{default:o(()=>{var O;return[e(t)?f("",!0):(c(),y(h,{key:0,color:"primary",class:"mr-4",onClick:r[0]||(r[0]=A=>(E("sign"),u.value=!0))},{default:o(()=>[_("Sign in")]),_:1})),e(t)?f("",!0):(c(),y(h,{key:1,color:"primary",onClick:r[1]||(r[1]=A=>(E("login"),u.value=!0))},{default:o(()=>[_("Log in")]),_:1})),e(t)?(c(),y(h,{key:2,class:"mr-4 mb-4",color:"primary",onClick:ee},{default:o(()=>[_("Log out")]),_:1})):f("",!0),e(t)?(c(),y(h,{key:3,color:"primary",class:"mb-4",onClick:r[2]||(r[2]=A=>(E("changeUserData"),u.value=!0))},{default:o(()=>[_("Change data")]),_:1})):f("",!0),(O=e(p))!=null&&O.name?(c(),y(oe,{key:4,userId:e(t),onSuccess:le,imgPath:e(U)},null,8,["userId","imgPath"])):f("",!0)]}),_:1}),e(t)&&((g=e(p))!=null&&g.name)?(c(),L("div",Ue,[N("p",null,$(e(p).name),1),N("p",null,$(e(p).email),1)])):f("",!0)]}),_:1}),i(G,{modelValue:e(u),"onUpdate:modelValue":r[8]||(r[8]=g=>w(u)?u.value=g:null),"max-width":"500"},{default:o(()=>[i(R,null,{default:o(()=>[i(q,null,{default:o(()=>[N("span",null,$(Q[e(s)]),1)]),_:1}),i(ue,null,{default:o(()=>[e(s)!=="login"?(c(),y(D,{key:0,modelValue:e(b),"onUpdate:modelValue":r[3]||(r[3]=g=>w(b)?b.value=g:null),label:"Name","aria-required":"true"},null,8,["modelValue"])):f("",!0),e(s)!=="changeUserData"?(c(),y(D,{key:1,modelValue:e(C),"onUpdate:modelValue":r[4]||(r[4]=g=>w(C)?C.value=g:null),label:"Email","aria-required":"true"},null,8,["modelValue"])):f("",!0),i(D,{modelValue:e(d),"onUpdate:modelValue":r[5]||(r[5]=g=>w(d)?d.value=g:null),label:"password",type:e(S)?"text":"password","aria-required":"true"},{default:o(()=>[i(j,{onClick:te,class:"position-absolute right-0 pr-4"},{default:o(()=>[_($(e(S)?"mdi-eye":"mdi-eye-off"),1)]),_:1})]),_:1},8,["modelValue","type"]),e(s)==="changeUserData"?(c(),y(D,{key:2,modelValue:e(k),"onUpdate:modelValue":r[7]||(r[7]=g=>w(k)?k.value=g:null),label:"Repeat new password",type:e(x)?"text":"password","aria-required":"true"},{default:o(()=>[i(j,{onClick:r[6]||(r[6]=g=>x.value=!e(x)),class:"position-absolute right-0 pr-4"},{default:o(()=>[_($(e(x)?"mdi-eye":"mdi-eye-off"),1)]),_:1})]),_:1},8,["modelValue","type"])):f("",!0)]),_:1}),i(z,null,{default:o(()=>[e(m)?(c(),L("p",Se,$(e(m)),1)):f("",!0),i(h,{color:"primary",onClick:P},{default:o(()=>[_("Close")]),_:1}),i(h,{color:"primary",onClick:J},{default:o(()=>[_("Confirm")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(n)==="sign"?(c(),y(T,{key:0},{text:o(()=>[_("Registration completed successfully!")]),_:1})):f("",!0),e(n)==="changeUserData"?(c(),y(T,{key:1},{text:o(()=>[_("User data updated successfully")]),_:1})):f("",!0),e(n)==="logout"?(c(),y(T,{key:2},{text:o(()=>[_("You have Log out successfully")]),_:1})):f("",!0)]),e(p)?f("",!0):(c(),y(be,{key:0,fluid:""},{default:o(()=>[i(M,{class:"h-screen align-center justify-center"},{default:o(()=>[i(Ve,{size:70,width:7,color:"primary",indeterminate:""})]),_:1})]),_:1}))],64)}}},Le=pe(xe,[["__scopeId","data-v-5036bbe2"]]);export{Le as default};
