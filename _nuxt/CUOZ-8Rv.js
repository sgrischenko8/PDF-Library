import{_ as oe}from"./CZAlslus.js";import{b as F,c as q,d as R,e as z,u as se,a as A,f as re,V as U}from"./BpB73dj0.js";import{y as L,z as G,A as ue,B as ne,C as ie,D as de,E as ce,r as v,o as d,s as y,w as o,b as i,F as fe,d as h,u as e,x as w,_ as me,n as ge,c as T,a as D,v as f,G as pe,t as b}from"./1XXDet7t.js";import{m as ve,b as C,a as ye,c as M,V as he}from"./CGWm2qLk.js";import"./CxLR3Rdp.js";const K=L.reduce((t,l)=>(t[l]={type:[Boolean,String,Number],default:!1},t),{}),H=L.reduce((t,l)=>{const s="offset"+G(l);return t[s]={type:[String,Number],default:null},t},{}),W=L.reduce((t,l)=>{const s="order"+G(l);return t[s]={type:[String,Number],default:null},t},{}),j={col:Object.keys(K),offset:Object.keys(H),order:Object.keys(W)};function _e(t,l,s){let u=t;if(!(s==null||s===!1)){if(l){const n=l.replace(t,"");u+=`-${n}`}return t==="col"&&(u="v-"+u),t==="col"&&(s===""||s===!0)||(u+=`-${s}`),u.toLowerCase()}}const Ve=["auto","start","end","center","baseline","stretch"],ke=ue({cols:{type:[Boolean,String,Number],default:!1},...K,offset:{type:[String,Number],default:null},...H,order:{type:[String,Number],default:null},...W,alignSelf:{type:String,default:null,validator:t=>Ve.includes(t)},...ne(),...ve()},"VCol"),Ce=ie()({name:"VCol",props:ke(),setup(t,l){let{slots:s}=l;const u=de(()=>{const n=[];let _;for(_ in j)j[_].forEach(c=>{const k=t[c],m=_e(_,c,k);m&&n.push(m)});const V=n.some(c=>c.startsWith("v-col-"));return n.push({"v-col":!V||!t.cols,[`v-col-${t.cols}`]:t.cols,[`offset-${t.offset}`]:t.offset,[`order-${t.order}`]:t.order,[`align-self-${t.alignSelf}`]:t.alignSelf}),n});return()=>{var n;return ce(t.tag,{class:[u.value,t.class],style:t.style},(n=s.default)==null?void 0:n.call(s))}}}),be={__name:"SuccessModal",setup(t){const l=v(!0);return(s,u)=>(d(),y(z,{modelValue:e(l),"onUpdate:modelValue":u[1]||(u[1]=n=>w(l)?l.value=n:null),"max-width":"500"},{default:o(()=>[i(F,null,{default:o(()=>[i(q,null,{default:o(()=>[fe(s.$slots,"text",{},()=>[h("Completed")])]),_:3}),i(R,null,{default:o(()=>[i(C,{color:"primary",onClick:u[0]||(u[0]=n=>l.value=!1)},{default:o(()=>[h("Close")]),_:1})]),_:1})]),_:3})]),_:3},8,["modelValue"]))}},we={key:0,class:"text-right pr-4"},Se={key:0,class:"errorMessage text-left mr-auto pl-4"},$e={__name:"index",setup(t){const l=se("userId"),s=v(null),u=v(!1),n=v(null),_=v(""),V=v(""),c=v(""),k=v(""),m=v(""),S=v(""),g=v(null),$=v(!1),x=v(!1);function Y(){s.value==="sign"&&Q(),s.value==="login"&&X(),s.value==="changeUserData"&&ee()}const J={sign:"Create account",login:"Login",changeUserData:"Change account data"};function P(){m.value="",s.value=null,u.value=!1}function N(a){s.value=a}async function Q(){try{await $fetch("http://localhost:3001/users/register",{method:"POST",body:{name:_.value,email:V.value,password:c.value},credentials:"include"}),n.value="sign",P()}catch(a){console.log("Error adding user:",a.response._data.message),m.value=a.response._data.message}}async function X(){try{const a=await $fetch("http://localhost:3001/users/login",{method:"POST",body:{email:V.value,password:c.value},credentials:"include"});a.photo&&(S.value=`http://localhost:3001/${a.photo}`),P(),g.value=a,l.value=a._id}catch(a){console.error("Error logging user:",a),m.value=a.response._data.message}}async function Z(){try{await $fetch("http://localhost:3001/users/logout",{method:"POST",credentials:"include"}),n.value="logout",m.value="",g.value={},l.value=""}catch(a){console.error("Error logging user:",a),l.value="",m.value=a.response._data.message}}async function B(){try{if(!l.value){g.value={};return}const a=await $fetch("http://localhost:3001/users/current",{method:"GET",credentials:"include"});g.value=a,a.photo&&(S.value=`http://localhost:3001/${a.photo}`)}catch(a){console.error("Error fetching user data:",a),g.value=[],l.value=null}}async function ee(){if(c.value!==k.value){m.value="Passwords do not match";return}const a={};if(_.value&&(a.name=_.value),c.value&&(a.password=c.value),Object.keys(a).length===0){m.value="No data to update";return}l.value=g.value._id;try{const r=await $fetch(`http://localhost:3001/users/${g.value._id}`,{method:"PATCH",body:a,credentials:"include"});P(),g.value=r,_.value="",c.value="",k.value=""}catch(r){console.error("Error updating user data:",r),m.value=r.response._data.message}}function te(a){S.value=`http://localhost:3001/${a}`,B()}function ae(){$.value=!$.value}return ge(()=>{B()}),(a,r)=>{const le=oe,E=be;return d(),T(pe,null,[D("div",null,[i(A,{class:"d-block"},{default:o(()=>{var p;return[i(Ce,{class:"text-right ml-auto"},{default:o(()=>{var I;return[e(l)?f("",!0):(d(),y(C,{key:0,color:"primary",class:"mr-4",onClick:r[0]||(r[0]=O=>(N("sign"),u.value=!0))},{default:o(()=>[h("Sign in")]),_:1})),e(l)?f("",!0):(d(),y(C,{key:1,color:"primary",onClick:r[1]||(r[1]=O=>(N("login"),u.value=!0))},{default:o(()=>[h("Log in")]),_:1})),e(l)?(d(),y(C,{key:2,class:"mr-4 mb-4",color:"primary",onClick:Z},{default:o(()=>[h("Log out")]),_:1})):f("",!0),e(l)?(d(),y(C,{key:3,color:"primary",class:"mb-4",onClick:r[2]||(r[2]=O=>(N("changeUserData"),u.value=!0))},{default:o(()=>[h("Change data")]),_:1})):f("",!0),(I=e(g))!=null&&I.name?(d(),y(le,{key:4,userId:e(l),onSuccess:te,imgPath:e(S)},null,8,["userId","imgPath"])):f("",!0)]}),_:1}),e(l)&&((p=e(g))!=null&&p.name)?(d(),T("div",we,[D("p",null,b(e(g).name),1),D("p",null,b(e(g).email),1)])):f("",!0)]}),_:1}),i(z,{modelValue:e(u),"onUpdate:modelValue":r[8]||(r[8]=p=>w(u)?u.value=p:null),"max-width":"500"},{default:o(()=>[i(F,null,{default:o(()=>[i(q,null,{default:o(()=>[D("span",null,b(J[e(s)]),1)]),_:1}),i(re,null,{default:o(()=>[e(s)!=="login"?(d(),y(U,{key:0,modelValue:e(_),"onUpdate:modelValue":r[3]||(r[3]=p=>w(_)?_.value=p:null),label:"Name","aria-required":"true"},null,8,["modelValue"])):f("",!0),e(s)!=="changeUserData"?(d(),y(U,{key:1,modelValue:e(V),"onUpdate:modelValue":r[4]||(r[4]=p=>w(V)?V.value=p:null),label:"Email","aria-required":"true"},null,8,["modelValue"])):f("",!0),i(U,{modelValue:e(c),"onUpdate:modelValue":r[5]||(r[5]=p=>w(c)?c.value=p:null),label:"password",type:e($)?"text":"password","aria-required":"true"},{default:o(()=>[i(M,{onClick:ae,class:"position-absolute right-0 pr-4"},{default:o(()=>[h(b(e($)?"mdi-eye":"mdi-eye-off"),1)]),_:1})]),_:1},8,["modelValue","type"]),e(s)==="changeUserData"?(d(),y(U,{key:2,modelValue:e(k),"onUpdate:modelValue":r[7]||(r[7]=p=>w(k)?k.value=p:null),label:"Repeat new password",type:e(x)?"text":"password","aria-required":"true"},{default:o(()=>[i(M,{onClick:r[6]||(r[6]=p=>x.value=!e(x)),class:"position-absolute right-0 pr-4"},{default:o(()=>[h(b(e(x)?"mdi-eye":"mdi-eye-off"),1)]),_:1})]),_:1},8,["modelValue","type"])):f("",!0)]),_:1}),i(R,null,{default:o(()=>[e(m)?(d(),T("p",Se,b(e(m)),1)):f("",!0),i(C,{color:"primary",onClick:P},{default:o(()=>[h("Close")]),_:1}),i(C,{color:"primary",onClick:Y},{default:o(()=>[h("Confirm")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(n)==="sign"?(d(),y(E,{key:0},{text:o(()=>[h("Registration completed successfully!")]),_:1})):f("",!0),e(n)==="changeUserData"?(d(),y(E,{key:1},{text:o(()=>[h("User data updated successfully")]),_:1})):f("",!0),e(n)==="logout"?(d(),y(E,{key:2},{text:o(()=>[h("You have Log out successfully")]),_:1})):f("",!0)]),e(g)?f("",!0):(d(),y(ye,{key:0,fluid:""},{default:o(()=>[i(A,{class:"h-screen align-center justify-center"},{default:o(()=>[i(he,{size:70,width:7,color:"primary",indeterminate:""})]),_:1})]),_:1}))],64)}}},Ee=me($e,[["__scopeId","data-v-650fa85b"]]);export{Ee as default};
